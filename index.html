import React, { useState, useEffect, useRef } from 'react';
import { Sword, Zap, Shield, Heart } from 'lucide-react';

const AbsoluteSmash = () => {
  const [gameState, setGameState] = useState('menu'); // menu, mode-select, character-select, playing, gameover
  const [gameMode, setGameMode] = useState(null); // 'lives' or 'health'
  const [player1, setPlayer1] = useState(null);
  const [player2, setPlayer2] = useState(null);
  const [p1Health, setP1Health] = useState(100);
  const [p2Health, setP2Health] = useState(100);
  const [p1Lives, setP1Lives] = useState(3);
  const [p2Lives, setP2Lives] = useState(3);
  const [p1Position, setP1Position] = useState({ x: 300, y: 300 });
  const [p2Position, setP2Position] = useState({ x: 500, y: 300 });
  const [p1Velocity, setP1Velocity] = useState({ x: 0, y: 0 });
  const [p2Velocity, setP2Velocity] = useState({ x: 0, y: 0 });
  const [p1Special, setP1Special] = useState(0);
  const [p2Special, setP2Special] = useState(0);
  const [p1Attacking, setP1Attacking] = useState(false);
  const [p2Attacking, setP2Attacking] = useState(false);
  const [winner, setWinner] = useState(null);
  const [keys, setKeys] = useState({});
  const [p1Jumping, setP1Jumping] = useState(false);
  const [p2Jumping, setP2Jumping] = useState(false);
  const [roundTimer, setRoundTimer] = useState(99);

  const characters = {
    ninja: {
      name: 'Shadow Blade',
      color: '#1a1a2e',
      accent: '#9d4edd',
      stats: { speed: 8, power: 6, defense: 5 },
      moves: {
        basic: { name: 'Shuriken Strike', damage: 8 },
        special: { name: 'Shadow Clone', damage: 25, cost: 50 }
      },
      icon: <Sword className="w-8 h-8" />
    },
    brawler: {
      name: 'Iron Fist',
      color: '#d62828',
      accent: '#f77f00',
      stats: { speed: 5, power: 9, defense: 7 },
      moves: {
        basic: { name: 'Power Punch', damage: 12 },
        special: { name: 'Meteor Strike', damage: 30, cost: 50 }
      },
      icon: <Zap className="w-8 h-8" />
    },
    guardian: {
      name: 'Steel Guardian',
      color: '#2b9348',
      accent: '#55a630',
      stats: { speed: 4, power: 7, defense: 9 },
      moves: {
        basic: { name: 'Shield Bash', damage: 10 },
        special: { name: 'Fortress Wall', damage: 20, cost: 50 }
      },
      icon: <Shield className="w-8 h-8" />
    }
  };

  useEffect(() => {
    const handleKeyDown = (e) => {
      setKeys(prev => ({ ...prev, [e.key.toLowerCase()]: true }));
    };

    const handleKeyUp = (e) => {
      setKeys(prev => ({ ...prev, [e.key.toLowerCase()]: false }));
    };

    window.addEventListener('keydown', handleKeyDown);
    window.addEventListener('keyup', handleKeyUp);

    return () => {
      window.removeEventListener('keydown', handleKeyDown);
      window.removeEventListener('keyup', handleKeyUp);
    };
  }, []);

  useEffect(() => {
    if (gameState !== 'playing') return;

    const gameLoop = setInterval(() => {
      // Player 1 movement (WASD)
      let p1VelX = 0;
      let p1VelY = p1Velocity.y;

      if (keys['a']) p1VelX = -(player1 ? characters[player1].stats.speed : 5);
      if (keys['d']) p1VelX = (player1 ? characters[player1].stats.speed : 5);
      
      // Player 2 movement (Arrow keys)
      let p2VelX = 0;
      let p2VelY = p2Velocity.y;

      
      if (keys['arrowleft']) p2VelX = -(player2 ? characters[player2].stats.speed : 5);
      if (keys['arrowright']) p2VelX = (player2 ? characters[player2].stats.speed : 5);

      // Gravity
      p1VelY += 0.8;
      p2VelY += 0.8;

      // Check platform collisions
      const checkPlatformCollision = (pos, vel, isP1) => {
        const playerBottom = pos.y + 80;
        const isJumping = isP1 ? p1Jumping : p2Jumping;
        const canJump = isP1 ? keys['w'] : keys['arrowup'];
        
        if (gameMode === 'lives') {
          // Lives mode - floating island platform (centered below players)
          if (pos.x >= 80 && pos.x <= 780 && playerBottom >= 360 && playerBottom <= 420 && vel >= 0) {
            if (canJump && !isJumping) {
              if (isP1) setP1Jumping(true);
              else setP2Jumping(true);
              return { y: 280, grounded: true, jumping: true };
            }
            return { y: 280, grounded: true, jumping: false };
          }
        } else {
          // Health mode - ground only
          if (playerBottom >= 500) {
            if (canJump && !isJumping) {
              if (isP1) setP1Jumping(true);
              else setP2Jumping(true);
              return { y: 420, grounded: true, jumping: true };
            }
            return { y: 420, grounded: true, jumping: false };
          }
        }
        
        // Fall off platform/in air
        return { y: pos.y + vel, grounded: false, jumping: false };
      };

      // Update positions with platform collision
      const newP1Pos = {
        x: Math.max(50, Math.min(850, p1Position.x + p1VelX)),
        y: p1Position.y
      };
      const p1Collision = checkPlatformCollision(newP1Pos, p1VelY, true);
      newP1Pos.y = p1Collision.y;
      
      if (p1Collision.jumping) {
        p1VelY = -18;
      }

      const newP2Pos = {
        x: Math.max(50, Math.min(850, p2Position.x + p2VelX)),
        y: p2Position.y
      };
      const p2Collision = checkPlatformCollision(newP2Pos, p2VelY, false);
      newP2Pos.y = p2Collision.y;
      
      if (p2Collision.jumping) {
        p2VelY = -18;
      }

      setP1Position(newP1Pos);
      setP2Position(newP2Pos);

      // Reset velocity if grounded
      if (p1Collision.grounded && !p1Collision.jumping) {
        p1VelY = 0;
        if (p1Jumping) setP1Jumping(false);
      }
      if (p2Collision.grounded && !p2Collision.jumping) {
        p2VelY = 0;
        if (p2Jumping) setP2Jumping(false);
      }

      setP1Velocity({ x: p1VelX, y: p1VelY });
      setP2Velocity({ x: p2VelX, y: p2VelY });

      // Attack detection
      if (keys['s'] && !p1Attacking && player1) {
        setP1Attacking(true);
        const distance = Math.abs(p1Position.x - p2Position.x);
        if (distance < 80 && Math.abs(p1Position.y - p2Position.y) < 60) {
          if (gameMode === 'health') {
            setP2Health(prev => Math.max(0, prev - characters[player1].moves.basic.damage));
          }
          // Charge special meter
          setP1Special(prev => Math.min(100, prev + 20));
        }
        setTimeout(() => setP1Attacking(false), 300);
      }

      if (keys['arrowdown'] && !p2Attacking && player2) {
        setP2Attacking(true);
        const distance = Math.abs(p1Position.x - p2Position.x);
        if (distance < 80 && Math.abs(p1Position.y - p2Position.y) < 60) {
          if (gameMode === 'health') {
            setP1Health(prev => Math.max(0, prev - characters[player2].moves.basic.damage));
          }
          // Charge special meter
          setP2Special(prev => Math.min(100, prev + 20));
        }
        setTimeout(() => setP2Attacking(false), 300);
      }

      // Special attacks
      if (keys['f'] && p1Special >= 100 && player1) {
        setP1Special(0);
        const distance = Math.abs(p1Position.x - p2Position.x);
        if (distance < 120) {
          if (gameMode === 'health') {
            setP2Health(prev => Math.max(0, prev - characters[player1].moves.special.damage));
          } else {
            // In lives mode, knock opponent off platform
            setP2Position(prev => ({ ...prev, y: prev.y - 50 }));
            setP2Velocity(prev => ({ ...prev, y: -20 }));
          }
        }
      }

      if (keys['enter'] && p2Special >= 100 && player2) {
        setP2Special(0);
        const distance = Math.abs(p1Position.x - p2Position.x);
        if (distance < 120) {
          if (gameMode === 'health') {
            setP1Health(prev => Math.max(0, prev - characters[player2].moves.special.damage));
          } else {
            // In lives mode, knock opponent off platform
            setP1Position(prev => ({ ...prev, y: prev.y - 50 }));
            setP1Velocity(prev => ({ ...prev, y: -20 }));
          }
        }
      }
    }, 1000 / 60);

    return () => clearInterval(gameLoop);
  }, [gameState, keys, p1Position, p2Position, p1Velocity, p2Velocity, p1Attacking, p2Attacking, player1, player2, p1Special, p2Special]);

  useEffect(() => {
    if (gameState === 'playing' && gameMode === 'health') {
      const timer = setInterval(() => {
        setRoundTimer(prev => {
          if (prev <= 1) {
            clearInterval(timer);
            if (p1Health > p2Health) setWinner('Player 1');
            else if (p2Health > p1Health) setWinner('Player 2');
            else setWinner('Draw');
            setGameState('gameover');
            return 0;
          }
          return prev - 1;
        });
      }, 1000);

      return () => clearInterval(timer);
    }
  }, [gameState, gameMode, p1Health, p2Health]);

  useEffect(() => {
    if (gameMode === 'health' && p1Health <= 0) {
      setWinner('Player 2');
      setGameState('gameover');
    } else if (gameMode === 'health' && p2Health <= 0) {
      setWinner('Player 1');
      setGameState('gameover');
    }
  }, [p1Health, p2Health, gameMode]);

  const startGame = () => {
    if (player1 && player2) {
      setGameState('playing');
      setP1Health(100);
      setP2Health(100);
      setP1Lives(3);
      setP2Lives(3);
      setP1Special(0);
      setP2Special(0);
      
      // Different starting positions based on mode
      if (gameMode === 'lives') {
        setP1Position({ x: 350, y: 280 });
        setP2Position({ x: 500, y: 280 });
      } else {
        setP1Position({ x: 200, y: 420 });
        setP2Position({ x: 600, y: 420 });
      }
      
      setRoundTimer(99);
      setWinner(null);
    }
  };

  const resetGame = () => {
    setGameState('menu');
    setGameMode(null);
    setPlayer1(null);
    setPlayer2(null);
    setWinner(null);
  };

  if (gameState === 'menu') {
    return (
      <div className="w-full h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-black flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-7xl font-bold text-white mb-4 tracking-wider">
            ABSOLUTE <span className="text-yellow-400">SMASH</span>
          </h1>
          <p className="text-2xl text-gray-300 mb-8">Ultimate Fighting Championship</p>
          <button
            onClick={() => setGameState('mode-select')}
            className="bg-yellow-400 hover:bg-yellow-500 text-black font-bold text-xl px-12 py-4 rounded-lg transition-all transform hover:scale-105"
          >
            START GAME
          </button>
          <div className="mt-12 text-gray-400 text-sm">
            <p>Player 1: WASD to move, S to attack, F for special</p>
            <p>Player 2: Arrows to move, ‚Üì to attack, Enter for special</p>
          </div>
        </div>
      </div>
    );
  }

  if (gameState === 'mode-select') {
    return (
      <div className="w-full h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-black flex items-center justify-center">
        <div className="text-center max-w-4xl">
          <h2 className="text-5xl font-bold text-white mb-12">SELECT GAME MODE</h2>
          
          <div className="grid grid-cols-2 gap-8">
            {/* Lives Mode */}
            <button
              onClick={() => {
                setGameMode('lives');
                setGameState('character-select');
              }}
              className="bg-gradient-to-b from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 p-8 rounded-2xl border-4 border-blue-400 transition-all transform hover:scale-105"
            >
              <div className="text-6xl mb-4">üí´</div>
              <h3 className="text-3xl font-bold text-white mb-4">LIVES MODE</h3>
              <p className="text-gray-200 mb-4">Classic Smash Bros style!</p>
              <div className="flex justify-center gap-2 mb-4">
                <Heart className="w-8 h-8 text-red-500 fill-red-500" />
                <Heart className="w-8 h-8 text-red-500 fill-red-500" />
                <Heart className="w-8 h-8 text-red-500 fill-red-500" />
              </div>
              <p className="text-sm text-gray-300">3 Lives ‚Ä¢ Knock opponents off the platform!</p>
            </button>

            {/* Health Mode */}
            <button
              onClick={() => {
                setGameMode('health');
                setGameState('character-select');
              }}
              className="bg-gradient-to-b from-red-600 to-red-800 hover:from-red-500 hover:to-red-700 p-8 rounded-2xl border-4 border-red-400 transition-all transform hover:scale-105"
            >
              <div className="text-6xl mb-4">‚öîÔ∏è</div>
              <h3 className="text-3xl font-bold text-white mb-4">HEALTH MODE</h3>
              <p className="text-gray-200 mb-4">Traditional fighting game!</p>
              <div className="w-full bg-gray-700 h-6 rounded-full overflow-hidden mb-4">
                <div className="h-full bg-gradient-to-r from-green-500 to-red-500 w-full"></div>
              </div>
              <p className="text-sm text-gray-300">Health Bar ‚Ä¢ Reduce opponent's HP to zero!</p>
            </button>
          </div>

          <button
            onClick={() => setGameState('menu')}
            className="mt-8 text-gray-400 hover:text-white transition-all"
          >
            ‚Üê Back to Menu
          </button>
        </div>
      </div>
    );
  }

  if (gameState === 'character-select') {
    return (
      <div className="w-full h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-black p-8">
        <h2 className="text-5xl font-bold text-white text-center mb-12">SELECT YOUR FIGHTER</h2>
        
        <div className="grid grid-cols-2 gap-8 max-w-6xl mx-auto">
          {/* Player 1 */}
          <div className="bg-gray-900 rounded-lg p-6">
            <h3 className="text-3xl font-bold text-yellow-400 mb-6 text-center">PLAYER 1</h3>
            <div className="space-y-4">
              {Object.entries(characters).map(([key, char]) => (
                <button
                  key={key}
                  onClick={() => setPlayer1(key)}
                  className={`w-full p-4 rounded-lg flex items-center gap-4 transition-all ${
                    player1 === key
                      ? 'bg-yellow-400 text-black scale-105'
                      : 'bg-gray-800 text-white hover:bg-gray-700'
                  }`}
                >
                  <div style={{ color: char.accent }}>{char.icon}</div>
                  <div className="flex-1 text-left">
                    <div className="font-bold text-lg">{char.name}</div>
                    <div className="text-sm opacity-80">
                      Speed: {char.stats.speed} | Power: {char.stats.power} | Defense: {char.stats.defense}
                    </div>
                  </div>
                </button>
              ))}
            </div>
          </div>

          {/* Player 2 */}
          <div className="bg-gray-900 rounded-lg p-6">
            <h3 className="text-3xl font-bold text-blue-400 mb-6 text-center">PLAYER 2</h3>
            <div className="space-y-4">
              {Object.entries(characters).map(([key, char]) => (
                <button
                  key={key}
                  onClick={() => setPlayer2(key)}
                  className={`w-full p-4 rounded-lg flex items-center gap-4 transition-all ${
                    player2 === key
                      ? 'bg-blue-400 text-black scale-105'
                      : 'bg-gray-800 text-white hover:bg-gray-700'
                  }`}
                >
                  <div style={{ color: char.accent }}>{char.icon}</div>
                  <div className="flex-1 text-left">
                    <div className="font-bold text-lg">{char.name}</div>
                    <div className="text-sm opacity-80">
                      Speed: {char.stats.speed} | Power: {char.stats.power} | Defense: {char.stats.defense}
                    </div>
                  </div>
                </button>
              ))}
            </div>
          </div>
        </div>

        <div className="text-center mt-8">
          <button
            onClick={startGame}
            disabled={!player1 || !player2}
            className={`text-2xl font-bold px-12 py-4 rounded-lg transition-all ${
              player1 && player2
                ? 'bg-green-500 hover:bg-green-600 text-white transform hover:scale-105'
                : 'bg-gray-600 text-gray-400 cursor-not-allowed'
            }`}
          >
            FIGHT!
          </button>
        </div>
      </div>
    );
  }

  if (gameState === 'gameover') {
    return (
      <div className="w-full h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-black flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-6xl font-bold text-white mb-8">
            {winner === 'Draw' ? 'DRAW!' : `${winner} WINS!`}
          </h1>
          <div className="space-x-4">
            <button
              onClick={startGame}
              className="bg-blue-500 hover:bg-blue-600 text-white font-bold text-xl px-8 py-4 rounded-lg transition-all"
            >
              REMATCH
            </button>
            <button
              onClick={resetGame}
              className="bg-gray-600 hover:bg-gray-700 text-white font-bold text-xl px-8 py-4 rounded-lg transition-all"
            >
              MAIN MENU
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="w-full h-screen bg-gradient-to-b from-sky-400 via-sky-300 to-green-200 overflow-hidden relative">
      {/* Sky and Clouds */}
      <div className="absolute inset-0">
        {/* Sun */}
        <div className="absolute top-10 right-20 w-24 h-24 bg-yellow-300 rounded-full shadow-lg shadow-yellow-400/50"></div>
        
        {/* Clouds */}
        <div className="absolute top-20 left-10 w-32 h-12 bg-white rounded-full opacity-80 blur-sm"></div>
        <div className="absolute top-24 left-16 w-24 h-10 bg-white rounded-full opacity-80 blur-sm"></div>
        
        <div className="absolute top-32 right-32 w-40 h-14 bg-white rounded-full opacity-70 blur-sm"></div>
        <div className="absolute top-36 right-40 w-28 h-12 bg-white rounded-full opacity-70 blur-sm"></div>
        
        <div className="absolute top-48 left-1/3 w-36 h-12 bg-white rounded-full opacity-75 blur-sm"></div>
        <div className="absolute top-52 left-1/3 w-28 h-10 bg-white rounded-full opacity-75 blur-sm" style={{marginLeft: '20px'}}></div>
      </div>
      
      {/* Distant Mountains */}
      <div className="absolute bottom-0 left-0 right-0 h-64 bg-gradient-to-b from-green-700 to-green-600 opacity-60" style={{
        clipPath: 'polygon(0 100%, 0 40%, 15% 20%, 25% 30%, 35% 10%, 50% 25%, 65% 5%, 75% 20%, 85% 15%, 100% 30%, 100% 100%)'
      }}></div>
      
      {/* Trees in background */}
      <div className="absolute bottom-0 left-0 right-0">
        {[100, 250, 400, 550, 700, 820].map((left, i) => (
          <div key={i} className="absolute" style={{left: `${left}px`, bottom: '150px'}}>
            {/* Tree trunk */}
            <div className="w-4 h-16 bg-gradient-to-r from-amber-900 to-amber-800 mx-auto rounded-sm"></div>
            {/* Tree foliage - multiple layers for depth */}
            <div className="absolute -top-12 left-1/2 -translate-x-1/2">
              <div className="w-20 h-20 bg-green-700 rounded-full opacity-90"></div>
              <div className="absolute top-2 left-2 w-16 h-16 bg-green-600 rounded-full"></div>
              <div className="absolute top-4 left-4 w-12 h-12 bg-green-500 rounded-full"></div>
            </div>
          </div>
        ))}
      </div>
      {/* HUD */}
      <div className="absolute top-0 left-0 right-0 p-4 bg-black bg-opacity-50">
        <div className="flex justify-between items-start max-w-6xl mx-auto">
          {/* Player 1 HUD */}
          <div className="w-1/3">
            <div className="text-yellow-400 font-bold text-xl mb-2">
              {player1 ? characters[player1].name : 'P1'}
            </div>
            
            {gameMode === 'health' && (
              <div className="bg-gray-800 h-8 rounded-full overflow-hidden border-2 border-gray-600">
                <div
                  className="bg-gradient-to-r from-green-500 to-yellow-500 h-full transition-all duration-300"
                  style={{ width: `${p1Health}%` }}
                />
              </div>
            )}
            
            {gameMode === 'lives' && (
              <div className="flex gap-2 mb-2">
                {[...Array(3)].map((_, i) => (
                  <Heart
                    key={i}
                    className={`w-6 h-6 ${i < p1Lives ? 'text-red-500 fill-red-500' : 'text-gray-600'}`}
                  />
                ))}
              </div>
            )}
            
            <div className="mt-2">
              <div className="text-xs text-gray-400 mb-1">SPECIAL</div>
              <div className="bg-gray-800 h-4 rounded-full overflow-hidden border-2 border-gray-600">
                <div
                  className={`h-full transition-all duration-300 ${p1Special >= 100 ? 'bg-yellow-400 animate-pulse' : 'bg-blue-500'}`}
                  style={{ width: `${p1Special}%` }}
                />
              </div>
            </div>
          </div>

          {/* Timer */}
          <div className="text-white text-5xl font-bold">
            {roundTimer}
          </div>

          {/* Player 2 HUD */}
          <div className="w-1/3">
            <div className="text-blue-400 font-bold text-xl mb-2 text-right">
              {player2 ? characters[player2].name : 'P2'}
            </div>
            
            {gameMode === 'health' && (
              <div className="bg-gray-800 h-8 rounded-full overflow-hidden border-2 border-gray-600">
                <div
                  className="bg-gradient-to-r from-green-500 to-yellow-500 h-full transition-all duration-300 ml-auto"
                  style={{ width: `${p2Health}%` }}
                />
              </div>
            )}
            
            {gameMode === 'lives' && (
              <div className="flex gap-2 mb-2 justify-end">
                {[...Array(3)].map((_, i) => (
                  <Heart
                    key={i}
                    className={`w-6 h-6 ${i < p2Lives ? 'text-red-500 fill-red-500' : 'text-gray-600'}`}
                  />
                ))}
              </div>
            )}
            
            <div className="mt-2">
              <div className="text-xs text-gray-400 mb-1 text-right">SPECIAL</div>
              <div className="bg-gray-800 h-4 rounded-full overflow-hidden border-2 border-gray-600">
                <div
                  className={`h-full transition-all duration-300 ml-auto ${p2Special >= 100 ? 'bg-yellow-400 animate-pulse' : 'bg-blue-500'}`}
                  style={{ width: `${p2Special}%` }}
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Game Arena */}
      <div className="relative h-full">
        {/* Lives Mode - Floating Island Platform */}
        {gameMode === 'lives' && (
          <div className="absolute left-1/2 -translate-x-1/2 top-[360px] w-[700px] h-[120px] z-10">
            {/* Main stone island platform */}
            <div className="absolute inset-0">
              {/* Top surface - fighting area */}
              <div className="absolute top-0 left-0 right-0 h-16 bg-gradient-to-b from-amber-700 via-amber-800 to-stone-700 rounded-t-[40px] border-t-8 border-x-8 border-amber-900">
                {/* Grass/moss on top */}
                <div className="absolute top-0 left-0 right-0 h-4 bg-gradient-to-b from-green-600 to-green-700 rounded-t-[35px] opacity-80"></div>
                
                {/* Grass blades */}
                {[...Array(40)].map((_, i) => (
                  <div
                    key={`grass${i}`}
                    className="absolute w-1 bg-green-800 opacity-60"
                    style={{
                      left: `${i * 2.5}%`,
                      top: '2px',
                      height: `${Math.random() * 6 + 3}px`,
                      transform: `rotate(${Math.random() * 20 - 10}deg)`
                    }}
                  />
                ))}
                
                {/* Stone cracks on surface */}
                <div className="absolute top-6 left-1/4 w-20 h-1 bg-stone-900 opacity-60 rotate-12"></div>
                <div className="absolute top-8 right-1/3 w-16 h-1 bg-stone-900 opacity-60 -rotate-6"></div>
              </div>
              
              {/* Main stone body with rock texture */}
              <div className="absolute top-16 left-4 right-4 bottom-0 bg-gradient-to-b from-stone-600 via-stone-700 to-stone-800 rounded-b-[50px] border-8 border-stone-900">
                {/* Rock texture patterns */}
                {[...Array(12)].map((_, i) => (
                  <div
                    key={`rock${i}`}
                    className="absolute bg-stone-800 opacity-40 rounded-full"
                    style={{
                      left: `${Math.random() * 80 + 5}%`,
                      top: `${Math.random() * 70 + 10}%`,
                      width: `${Math.random() * 30 + 20}px`,
                      height: `${Math.random() * 20 + 15}px`,
                      transform: `rotate(${Math.random() * 360}deg)`
                    }}
                  />
                ))}
                
                {/* Vertical cracks in stone */}
                <div className="absolute left-1/4 top-0 bottom-0 w-1 bg-stone-950 opacity-50"></div>
                <div className="absolute right-1/3 top-0 bottom-0 w-1 bg-stone-950 opacity-50"></div>
                
                {/* Horizontal layers in rock */}
                <div className="absolute left-0 right-0 h-1 bg-stone-950 opacity-40 top-1/3"></div>
                <div className="absolute left-0 right-0 h-1 bg-stone-950 opacity-40 top-2/3"></div>
                
                {/* Moss patches on sides */}
                <div className="absolute left-0 top-1/4 w-16 h-12 bg-green-900 opacity-30 rounded-r-full blur-sm"></div>
                <div className="absolute right-0 top-1/2 w-20 h-16 bg-green-900 opacity-30 rounded-l-full blur-sm"></div>
              </div>
              
              {/* Rocky bottom - irregular shape */}
              <div className="absolute bottom-0 left-8 right-8 h-12 bg-stone-800 opacity-90" style={{
                clipPath: 'polygon(10% 0%, 15% 50%, 25% 20%, 35% 60%, 45% 30%, 55% 70%, 65% 40%, 75% 80%, 85% 50%, 90% 0%)'
              }}></div>
              
              {/* Stalactites hanging from bottom */}
              <div className="absolute bottom-0 left-1/4 w-4 h-8 bg-stone-700 opacity-80" style={{clipPath: 'polygon(50% 0%, 0% 100%, 100% 100%)'}}></div>
              <div className="absolute bottom-0 right-1/3 w-3 h-6 bg-stone-700 opacity-80" style={{clipPath: 'polygon(50% 0%, 0% 100%, 100% 100%)'}}></div>
              <div className="absolute bottom-0 left-2/3 w-5 h-10 bg-stone-700 opacity-80" style={{clipPath: 'polygon(50% 0%, 0% 100%, 100% 100%)'}}></div>
            </div>
            
            {/* Floating debris/small rocks around island */}
            <div className="absolute -left-8 top-8 w-6 h-6 bg-stone-600 rounded opacity-70 border-2 border-stone-800"></div>
            <div className="absolute -right-6 top-12 w-4 h-4 bg-stone-600 rounded opacity-60 border-2 border-stone-800"></div>
            <div className="absolute left-10 -top-4 w-5 h-5 bg-stone-600 rounded opacity-65 border-2 border-stone-800"></div>
            
            {/* Large shadow beneath island */}
            <div className="absolute top-full left-20 right-20 h-40 bg-black/70 blur-3xl rounded-full mt-8"></div>
            
            {/* Magical glow effect under island */}
            <div className="absolute -bottom-8 left-1/4 right-1/4 h-12 bg-blue-400/30 blur-2xl rounded-full"></div>
          </div>
        )}
        
        {/* Ground */}
        <div className="absolute bottom-0 left-0 right-0 h-[150px] bg-gradient-to-t from-green-800 via-green-600 to-green-500">
          <div className="absolute top-0 left-0 right-0 h-2 bg-green-700 shadow-lg"></div>
          {/* Grass details */}
          {[...Array(30)].map((_, i) => (
            <div
              key={i}
              className="absolute w-1 bg-green-900 opacity-40"
              style={{
                left: `${i * 3 + 2}%`,
                top: '2px',
                height: `${Math.random() * 8 + 4}px`,
                transform: `rotate(${Math.random() * 20 - 10}deg)`
              }}
            />
          ))}
          <div className="absolute bottom-0 left-0 right-0 h-24 bg-amber-900"></div>
        </div>
        
        {/* Player 1 */}
        <div
          className={`absolute w-16 h-20 transition-all ${p1Attacking ? 'scale-110' : ''}`}
          style={{
            left: `${p1Position.x}px`,
            top: `${p1Position.y}px`
          }}
        >
          {/* Character body based on type */}
          {player1 === 'ninja' && (
            <div className="relative w-full h-full">
              {/* Head */}
              <div className="absolute top-0 left-1/2 -translate-x-1/2 w-10 h-10 bg-gray-900 rounded-full border-2 border-purple-500">
                {/* Eyes */}
                <div className="absolute top-3 left-2 w-1.5 h-1.5 bg-red-500 rounded-full"></div>
                <div className="absolute top-3 right-2 w-1.5 h-1.5 bg-red-500 rounded-full"></div>
              </div>
              {/* Body */}
              <div className="absolute top-10 left-1/2 -translate-x-1/2 w-8 h-10 bg-gray-900 border-2 border-purple-500">
                <div className="absolute inset-1 bg-purple-900 opacity-50"></div>
              </div>
              {/* Arms */}
              <div className="absolute top-12 left-0 w-3 h-6 bg-gray-900 rounded"></div>
              <div className="absolute top-12 right-0 w-3 h-6 bg-gray-900 rounded"></div>
            </div>
          )}
          {player1 === 'brawler' && (
            <div className="relative w-full h-full">
              {/* Head */}
              <div className="absolute top-0 left-1/2 -translate-x-1/2 w-12 h-12 bg-red-900 rounded-lg border-2 border-orange-500">
                {/* Eyes */}
                <div className="absolute top-3 left-2 w-2 h-3 bg-yellow-400 rounded"></div>
                <div className="absolute top-3 right-2 w-2 h-3 bg-yellow-400 rounded"></div>
                {/* Angry brow */}
                <div className="absolute top-2 left-2 w-2 h-1 bg-orange-600 -rotate-12"></div>
                <div className="absolute top-2 right-2 w-2 h-1 bg-orange-600 rotate-12"></div>
              </div>
              {/* Body */}
              <div className="absolute top-12 left-1/2 -translate-x-1/2 w-10 h-8 bg-red-800 border-2 border-orange-500 rounded-sm"></div>
              {/* Large Arms */}
              <div className="absolute top-13 left-0 w-4 h-7 bg-red-700 rounded border border-orange-600"></div>
              <div className="absolute top-13 right-0 w-4 h-7 bg-red-700 rounded border border-orange-600"></div>
            </div>
          )}
          {player1 === 'guardian' && (
            <div className="relative w-full h-full">
              {/* Helmet */}
              <div className="absolute top-0 left-1/2 -translate-x-1/2 w-12 h-10 bg-gradient-to-b from-gray-400 to-gray-600 rounded-t-lg border-2 border-green-600">
                {/* Visor */}
                <div className="absolute top-4 left-1/2 -translate-x-1/2 w-8 h-2 bg-green-400 opacity-70"></div>
              </div>
              {/* Armor body */}
              <div className="absolute top-10 left-1/2 -translate-x-1/2 w-11 h-10 bg-gradient-to-b from-gray-500 to-gray-700 border-2 border-green-600 rounded-sm">
                {/* Shield emblem */}
                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-5 border-2 border-green-400 rounded-sm"></div>
              </div>
              {/* Shoulder pads */}
              <div className="absolute top-10 -left-1 w-4 h-4 bg-gray-600 border border-green-600 rounded"></div>
              <div className="absolute top-10 -right-1 w-4 h-4 bg-gray-600 border border-green-600 rounded"></div>
            </div>
          )}
          {p1Attacking && (
            <div className="absolute -right-8 top-1/2 -translate-y-1/2 text-yellow-400 text-2xl animate-pulse">
              üí•
            </div>
          )}
        </div>

        {/* Player 2 */}
        <div
          className={`absolute w-16 h-20 transition-all ${p2Attacking ? 'scale-110' : ''}`}
          style={{
            left: `${p2Position.x}px`,
            top: `${p2Position.y}px`
          }}
        >
          {/* Character body based on type */}
          {player2 === 'ninja' && (
            <div className="relative w-full h-full">
              <div className="absolute top-0 left-1/2 -translate-x-1/2 w-10 h-10 bg-gray-900 rounded-full border-2 border-purple-500">
                <div className="absolute top-3 left-2 w-1.5 h-1.5 bg-red-500 rounded-full"></div>
                <div className="absolute top-3 right-2 w-1.5 h-1.5 bg-red-500 rounded-full"></div>
              </div>
              <div className="absolute top-10 left-1/2 -translate-x-1/2 w-8 h-10 bg-gray-900 border-2 border-purple-500">
                <div className="absolute inset-1 bg-purple-900 opacity-50"></div>
              </div>
              <div className="absolute top-12 left-0 w-3 h-6 bg-gray-900 rounded"></div>
              <div className="absolute top-12 right-0 w-3 h-6 bg-gray-900 rounded"></div>
            </div>
          )}
          {player2 === 'brawler' && (
            <div className="relative w-full h-full">
              <div className="absolute top-0 left-1/2 -translate-x-1/2 w-12 h-12 bg-red-900 rounded-lg border-2 border-orange-500">
                <div className="absolute top-3 left-2 w-2 h-3 bg-yellow-400 rounded"></div>
                <div className="absolute top-3 right-2 w-2 h-3 bg-yellow-400 rounded"></div>
                <div className="absolute top-2 left-2 w-2 h-1 bg-orange-600 -rotate-12"></div>
                <div className="absolute top-2 right-2 w-2 h-1 bg-orange-600 rotate-12"></div>
              </div>
              <div className="absolute top-12 left-1/2 -translate-x-1/2 w-10 h-8 bg-red-800 border-2 border-orange-500 rounded-sm"></div>
              <div className="absolute top-13 left-0 w-4 h-7 bg-red-700 rounded border border-orange-600"></div>
              <div className="absolute top-13 right-0 w-4 h-7 bg-red-700 rounded border border-orange-600"></div>
            </div>
          )}
          {player2 === 'guardian' && (
            <div className="relative w-full h-full">
              <div className="absolute top-0 left-1/2 -translate-x-1/2 w-12 h-10 bg-gradient-to-b from-gray-400 to-gray-600 rounded-t-lg border-2 border-green-600">
                <div className="absolute top-4 left-1/2 -translate-x-1/2 w-8 h-2 bg-green-400 opacity-70"></div>
              </div>
              <div className="absolute top-10 left-1/2 -translate-x-1/2 w-11 h-10 bg-gradient-to-b from-gray-500 to-gray-700 border-2 border-green-600 rounded-sm">
                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-5 border-2 border-green-400 rounded-sm"></div>
              </div>
              <div className="absolute top-10 -left-1 w-4 h-4 bg-gray-600 border border-green-600 rounded"></div>
              <div className="absolute top-10 -right-1 w-4 h-4 bg-gray-600 border border-green-600 rounded"></div>
            </div>
          )}
          {p2Attacking && (
            <div className="absolute -left-8 top-1/2 -translate-y-1/2 text-yellow-400 text-2xl animate-pulse">
              üí•
            </div>
          )}
        </div>
      </div>

      {/* Controls reminder */}
      <div className="absolute bottom-4 left-4 right-4 text-center text-white text-sm opacity-50">
        P1: WASD + S/F | P2: Arrows + ‚Üì/Enter
      </div>
    </div>
  );
};

export default AbsoluteSmash;
